{% extends 'index.html' %}
{% load static %}
{% block content %}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">

            <div class="card shadow-lg p-4" style="border:1px solid lightgrey; border-radius:10px;">
                <h3 class="text-center mb-4"
                    style="font-size:30px; font-family:Arial; font-weight:bold; color:darkblue;">
                    Add Student
                </h3>

                <form method="POST"
                      enctype="multipart/form-data"
                      action="{% url 'savestudent' %}"
                      name="myform"
                      onsubmit="return validation()">
                    {% csrf_token %}

                    <!-- Student Name -->
                    <div class="mb-3">
                        <label class="form-label">Student Name</label>
                        <input type="text" name="student_name" class="form-control"
                               onkeyup="validateName()">
                        <small class="text-danger" id="err_name"></small>
                    </div>

                    <!-- Roll Number -->
                    <div class="mb-3">
                        <label class="form-label">Roll Number</label>
                        <input type="text" name="student_rollno" class="form-control"
                               onkeyup="validateRoll()">
                        <small class="text-danger" id="err_roll"></small>
                    </div>

                    <!-- Register ID -->
                    <div class="mb-3">
                        <label class="form-label">Register Number</label>
                        <input type="text" name="student_regid" class="form-control"
                               onkeyup="validateReg()">
                        <small class="text-danger" id="err_reg"></small>
                    </div>

                    <!-- Batch -->
                    <div class="mb-3">
                        <label class="form-label">Batch</label>
                        <select name="student_batch" class="form-control"
                                onchange="validateBatch()">
                            <option value="">-- Select Batch --</option>
                            <option value="CSE">CSE</option>
                            <option value="EC">EC</option>
                            <option value="EEE">EEE</option>
                            <option value="CE">CE</option>
                        </select>
                        <small class="text-danger" id="err_batch"></small>
                    </div>

                    <!-- Semester -->
                    <div class="mb-3">
                        <label class="form-label">Semester</label>
                        <select name="student_sem" class="form-control"
                                onchange="validateSem()">
                            <option value="">-- Select Semester --</option>
                            <option value="S1">S1</option>
                            <option value="S2">S2</option>
                            <option value="S3">S3</option>
                            <option value="S4">S4</option>
                            <option value="S5">S5</option>
                            <option value="S6">S6</option>
                        </select>
                        <small class="text-danger" id="err_sem"></small>
                    </div>

                    <!-- Duration -->
                    <div class="mb-3">
                        <label class="form-label">Duration</label>
                        <input type="text" name="student_duration" class="form-control"
                               placeholder="2021-2025"
                               onkeyup="validateDuration()">
                        <small class="text-danger" id="err_duration"></small>
                    </div>

                    <!-- Mobile -->
                    <div class="mb-3">
                        <label class="form-label">Mobile Number</label>
                        <input type="tel" name="student_phone" class="form-control"
                               onkeyup="validatePhone()">
                        <small class="text-danger" id="err_phone"></small>
                    </div>

                    <!-- Email -->
                    <div class="mb-3">
                        <label class="form-label">Email Id</label>
                        <input type="email" name="student_email" class="form-control"
                               onkeyup="validateEmail()">
                        <small class="text-danger" id="err_email"></small>
                    </div>

                    <!-- Password -->
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input type="text" name="student_password" class="form-control"
                               onkeyup="validatePassword()">
                        <small class="text-danger" id="err_pwd"></small>
                    </div>

                    <!-- Confirm Password -->
                    <div class="mb-3">
                        <label class="form-label">Confirm Password</label>
                        <input type="text" name="student_confirm" class="form-control"
                               onkeyup="validateConfirm()">
                        <small class="text-danger" id="err_confirm"></small>
                    </div>

                    <!-- Profile -->
                    <div class="mb-3">
                        <label class="form-label">Profile Image</label>
                        <input type="file" name="student_prof" class="form-control">
                    </div>

                    <div class="text-center">
                        <button type="submit" class="btn btn-primary mt-3"
                                style="width:95%; border-radius:10px;">
                            Save Student
                        </button>
                    </div>

                </form>
            </div>

        </div>
    </div>
</div>

<!-- ================= JS VALIDATION ================= -->

<script>
    function validateName() {
        err_name.innerHTML = /^[A-Za-z.\s]+$/.test(myform.student_name.value.trim())
            ? "" : "Only alphabets, space and dot allowed";
    }

    function validateRoll() {
        err_roll.innerHTML = /^(?:[1-9][0-9]?|100)$/.test(myform.student_rollno.value.trim())
            ? "" : "Please Enter a Valid Roll number from 1";
    }

    function validateReg() {
        err_reg.innerHTML = /^[A-Z0-9]+$/.test(myform.student_regid.value.trim())
            ? "" : "CAPITAL letters and digits only";
    }

    function validateBatch() {
        err_batch.innerHTML = myform.student_batch.value === ""
            ? "Please select a batch"
            : "";
    }

    function validateSem() {
        err_sem.innerHTML = myform.student_sem.value === ""
            ? "Please select a semester"
            : "";
    }

    function validateDuration() {
        err_duration.innerHTML = /^\d{4}-\d{4}$/.test(myform.student_duration.value.trim())
            ? "" : "Duration must be YYYY-YYYY";
    }

    function validatePhone() {
        err_phone.innerHTML = /^[6-9]\d{9}$/.test(myform.student_phone.value.trim())
            ? "" : "Please Enter valid mobile number";
    }

    function validateEmail() {
        err_email.innerHTML = /^[a-zA-Z0-9._]+@gmail\.com$/.test(myform.student_email.value.trim())
            ? "" : "Please Enter a Valid Email";
    }

    function validatePassword() {
        err_pwd.innerHTML = /^(?=.*[A-Z])(?=.*\d)(?=.*[@#]).{6,}$/.test(myform.student_password.value)
            ? "" : "1 uppercase, 1 digit, 1 @/#, min 6 chars";
    }

    function validateConfirm() {
        err_confirm.innerHTML =
            myform.student_password.value === myform.student_confirm.value
                ? "" : "Passwords do not match";
    }

    function validation() {
        validateName();
        validateRoll();
        validateReg();
        validateBatch();
        validateSem();
        validateDuration();
        validatePhone();
        validateEmail();
        validatePassword();
        validateConfirm();

        return document.querySelectorAll(".text-danger:not(:empty)").length === 0;
    }
</script>

<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

{% if messages %}
{% for i in messages %}
{% if 'success' in i.tags %}
<script> swal('{{i}}', '', 'success'); </script>
{% elif 'warning' in i.tags %}
<script> swal('{{i}}', '', 'warning'); </script>
{% elif 'info' in i.tags %}
<script> swal('{{i}}', '', 'info'); </script>
{% elif 'error' in i.tags %}
<script> swal('{{i}}', '', 'error'); </script>
{% endif %}
{% endfor %}
{% endif %}

{% endblock %}
